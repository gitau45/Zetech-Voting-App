<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Dashboard | Zetech E-Voting</title>
<style>
:root {
  --primary: #0F2A44;
  --primary-light: #163A5F;
  --background: #F5F7FA;
  --text-dark: #1F2933;
  --text-muted: #4B5563;
  --white: #FFFFFF;
  --notification-bg: #D14343;
}

* { margin:0; padding:0; box-sizing:border-box; font-family:"Segoe UI", Roboto, Arial, sans-serif; }

body { background: var(--background); min-height:100vh; display:flex; flex-direction:column; }

header {
  background: var(--primary);
  color: var(--white);
  padding:1rem 1.2rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
  position: sticky;
  top: 0;
  z-index: 100;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
}

header h1 { font-size:1.4rem; font-weight:600; }

header button {
  padding:0.5rem 1rem;
  margin-left:0.5rem;
  color:#fff;
  border:none;
  border-radius:6px;
  font-weight:600;
  cursor:pointer;
  transition: background 0.3s ease;
}

header .logout-btn { background:#D14343; }
header .logout-btn:hover { background:#b73a3a; }

header .exit-btn { background:#6B7280; }
header .exit-btn:hover { background:#4B5563; }

main {
  flex:1;
  padding:1rem;
  display:flex;
  flex-direction:column;
  gap:1rem;
}

/* Dashboard Buttons */
.dashboard-btns {
  display:flex;
  flex-wrap:wrap;
  gap:1rem;
  justify-content:space-between;
}

.btn {
  flex: 1 1 48%;
  background: var(--primary);
  color: #fff;
  text-align:center;
  padding:1.5rem 0;
  border-radius:12px;
  font-weight:600;
  font-size:1.1rem;
  position: relative;
  cursor:pointer;
  transition: background 0.3s ease, transform 0.2s ease;
  box-shadow: 0 6px 12px rgba(0,0,0,0.1);
}

.btn:hover {
  background: var(--primary-light);
  transform: translateY(-2px);
}

.btn .badge {
  position:absolute;
  top:10px;
  right:12px;
  background: var(--notification-bg);
  color:#fff;
  font-size:0.75rem;
  font-weight:600;
  padding:0.25rem 0.5rem;
  border-radius:50%;
}

@media(max-width:500px) {
  .btn { flex:1 1 100%; font-size:1rem; padding:1.2rem 0; }
}
</style>
</head>
<body>

<header>
  <h1>Admin Dashboard</h1>
  <div>
    <button class="logout-btn" onclick="logout()">Logout</button>
    <button class="exit-btn" onclick="exitApp()">Exit</button>
  </div>
</header>

<main>
  <div class="dashboard-btns">
    <div class="btn" onclick="goTo('create-election.html')">Create Election</div>
    <div class="btn" onclick="goTo('verify-users.html')">
      Verify Users <span class="badge" id="pendingUsersBadge">0</span>
    </div>
    <div class="btn" onclick="goTo('view-tally.html')">
      View Tally <span class="badge" id="newVotesBadge">0</span>
    </div>
    <div class="btn" onclick="goTo('messages.html')">
      Messages <span class="badge" id="messagesBadge">0</span>
    </div>
  </div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA6sugBbX6kvd3RuwznAZkgHzAoEigpnj8",
  authDomain: "zetech-e-voting.firebaseapp.com",
  projectId: "zetech-e-voting",
  storageBucket: "zetech-e-voting.firebasestorage.app",
  messagingSenderId: "223450946411",
  appId: "1:223450946411:web:021848c8f6a98de7034a2e"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Check if admin is logged in
if (!localStorage.getItem("adminLoggedIn")) window.location.href = "admin.html";

// Navigation
window.goTo = (page) => window.location.href = page;

// Load notification badges
async function loadBadges() {
  try {
    const pendingSnap = await getDocs(query(collection(db, "Students"), where("approved", "==", false)));
    document.getElementById("pendingUsersBadge").innerText = pendingSnap.size;

    const votesSnap = await getDocs(collection(db, "Votes"));
    document.getElementById("newVotesBadge").innerText = votesSnap.size;

    const messagesSnap = await getDocs(collection(db, "Messages"));
    document.getElementById("messagesBadge").innerText = messagesSnap.size;
  } catch(err) {
    console.error("Failed to load badges:", err);
  }
}
loadBadges();

// Logout
function logout() {
  localStorage.removeItem("adminLoggedIn");
  window.location.href = "admin.html";
}

// Exit App
function exitApp() {
  if(confirm("Are you sure you want to exit the dashboard?")){
    localStorage.clear(); // clear all session data
    window.close(); // try to close the window
    // fallback in case window.close() does not work (most browsers block it)
    window.location.href = "admin.html";
  }
}
</script>

</body>
</html>
